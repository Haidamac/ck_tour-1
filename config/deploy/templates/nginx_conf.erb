upstream puma_<%= fetch(:nginx_config_name) %> { <%
  @backends = puma_binds.map do |bind|
     if bind.unix?
       "server unix:#{bind.address} #{fetch(:nginx_socket_flags)};"
     else
       "server #{bind.local.address} #{fetch(:nginx_http_flags)};"
     end
  end
%><% @backends.each do |server| %>
  <%= server %><% end %>
}
<% if fetch(:nginx_use_ssl) -%>
server {
  listen 80;
  server_name <%= fetch(:nginx_server_name) %>;
  return 301 https://$host$1$request_uri;
}
<% end -%>
